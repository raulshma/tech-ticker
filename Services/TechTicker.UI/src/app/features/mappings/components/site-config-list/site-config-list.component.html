<div class="site-config-list-container">
  <div class="header">
    <div class="title">
      <h2>Site Configurations</h2>
      <p>Manage scraping configurations for different e-commerce sites</p>
    </div>
    <button nz-button nzType="primary" (click)="createSiteConfig()">
      <i nz-icon nzType="plus"></i>
      New Site Configuration
    </button>
  </div>

  <div class="filters">
    <nz-row [nzGutter]="16">
      <nz-col [nzSpan]="6">
        <nz-input-group nzPrefixIcon="search">
          <input
            nz-input
            placeholder="Search by name..."
            [(ngModel)]="searchValue"
            (keyup.enter)="onSearch()"
          />
        </nz-input-group>
      </nz-col>
      <nz-col [nzSpan]="6">
        <nz-input-group nzPrefixIcon="global">
          <input
            nz-input
            placeholder="Filter by domain..."
            [(ngModel)]="domainFilter"
            (keyup.enter)="onSearch()"
          />
        </nz-input-group>
      </nz-col>
      <nz-col [nzSpan]="4">
        <nz-select
          nzPlaceHolder="Status"
          [(ngModel)]="activeFilter"
          (ngModelChange)="onSearch()"
          nzAllowClear
        >
          <nz-option nzValue="true" nzLabel="Active"></nz-option>
          <nz-option nzValue="false" nzLabel="Inactive"></nz-option>
        </nz-select>
      </nz-col>
      <nz-col [nzSpan]="8">
        <button nz-button nzType="primary" (click)="onSearch()">
          <i nz-icon nzType="search"></i>
          Search
        </button>
        <button nz-button nzType="default" (click)="onResetFilters()" style="margin-left: 8px;">
          <i nz-icon nzType="reload"></i>
          Reset
        </button>
      </nz-col>
    </nz-row>
  </div>

  <nz-table
    #table
    nzShowSizeChanger
    [nzData]="siteConfigs"
    [nzFrontPagination]="false"
    [nzLoading]="loading"
    [nzTotal]="total"
    [nzPageSize]="pageSize"
    [nzPageIndex]="pageIndex"
    (nzQueryParams)="onQueryParamsChange($event)"
    nzShowQuickJumper
    [nzPageSizeOptions]="[10, 20, 50, 100]"
  >
    <thead>
      <tr>
        <th nzColumnKey="domain" [nzSortFn]="true">Domain</th>
        <th nzColumnKey="name" [nzSortFn]="true">Name</th>
        <th>Description</th>
        <th nzColumnKey="isActive" [nzSortFn]="true">Status</th>
        <th>Selectors</th>
        <th nzColumnKey="createdAt" [nzSortFn]="true">Created</th>
        <th nzWidth="200px">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let config of siteConfigs">
        <td>
          <strong>{{ config.domain }}</strong>
        </td>
        <td>{{ config.name }}</td>
        <td>
          <span *ngIf="config.description; else noDescription">
            {{ config.description.length > 50 ? (config.description | slice:0:50) + '...' : config.description }}
          </span>
          <ng-template #noDescription>
            <span class="text-muted">No description</span>
          </ng-template>
        </td>
        <td>
          <nz-tag [nzColor]="getStatusTag(config.isActive).color">
            {{ getStatusTag(config.isActive).text }}
          </nz-tag>
        </td>
        <td>
          <nz-tag *ngIf="config.selectors.productName" nzColor="blue">Product Name</nz-tag>
          <nz-tag *ngIf="config.selectors.price" nzColor="green">Price</nz-tag>
          <nz-tag *ngIf="config.selectors.availability" nzColor="orange">Availability</nz-tag>
          <nz-tag *ngIf="config.selectors.image" nzColor="purple">Image</nz-tag>
          <nz-tag *ngIf="config.selectors.description" nzColor="cyan">Description</nz-tag>
        </td>
        <td>{{ config.createdAt | date:'short' }}</td>
        <td>
          <nz-button-group>
            <button
              nz-button
              nzType="primary"
              nzSize="small"
              (click)="viewSiteConfig(config.id)"
              nz-tooltip="View Details"
            >
              <i nz-icon nzType="eye"></i>
            </button>
            <button
              nz-button
              nzType="default"
              nzSize="small"
              (click)="editSiteConfig(config.id)"
              nz-tooltip="Edit"
            >
              <i nz-icon nzType="edit"></i>
            </button>
            <button
              nz-button
              [nzType]="config.isActive ? 'default' : 'primary'"
              nzSize="small"
              (click)="toggleStatus(config)"
              [nz-tooltip]="config.isActive ? 'Deactivate' : 'Activate'"
            >
              <i nz-icon [nzType]="config.isActive ? 'stop' : 'play-circle'"></i>
            </button>
            <button
              nz-button
              nzType="primary"
              nzDanger
              nzSize="small"
              (click)="deleteSiteConfig(config)"
              nz-tooltip="Delete"
            >
              <i nz-icon nzType="delete"></i>
            </button>
          </nz-button-group>
        </td>
      </tr>
    </tbody>
  </nz-table>

  <div *ngIf="!loading && siteConfigs.length === 0" class="empty-state">
    <nz-empty
      nzNotFoundImage="simple"
      nzNotFoundContent="No site configurations found"
    >
      <span nz-empty-footer>
        <button nz-button nzType="primary" (click)="createSiteConfig()">
          Create Site Configuration
        </button>
      </span>
    </nz-empty>
  </div>
</div>
