<div class="user-edit-container">
  <div class="header-section">
    <div class="breadcrumb-section">
      <nz-breadcrumb>
        <nz-breadcrumb-item>
          <a (click)="goToUsersList()">Users</a>
        </nz-breadcrumb-item>
        <nz-breadcrumb-item>
          <a (click)="goBack()">{{ getFullName() }}</a>
        </nz-breadcrumb-item>
        <nz-breadcrumb-item>Edit</nz-breadcrumb-item>
      </nz-breadcrumb>
    </div>

    <div class="header-actions">
      <button nz-button nzType="default" (click)="onCancel()" [disabled]="saving">
        Cancel
      </button>
      <button
        nz-button
        nzType="primary"
        [nzLoading]="saving"
        (click)="onSubmit()"
        [disabled]="!editForm.valid || saving"
      >
        <span *ngIf="!saving">Save Changes</span>
        <span *ngIf="saving">Saving...</span>
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="loading-container">
    <nz-spin nzSize="large" nzTip="Loading user details..."></nz-spin>
  </div>

  <div *ngIf="!loading && user" class="content-section">
    <nz-card nzTitle="Edit User Information" class="edit-card">
      <form nz-form [formGroup]="editForm" [nzLayout]="'vertical'" (ngSubmit)="onSubmit()">
        <!-- User Identity Section (Read-only) -->
        <div class="form-section">
          <h4 class="section-title">User Identity</h4>
          <div nz-row [nzGutter]="24">
            <div nz-col [nzSpan]="24" [nzMd]="12">
              <nz-form-item>
                <nz-form-label nzRequired>Email Address</nz-form-label>
                <nz-form-control>
                  <input
                    nz-input
                    formControlName="email"
                    placeholder="Email address"
                    readonly
                    class="readonly-input"
                  />
                  <small class="form-text text-muted">Email address cannot be changed for security reasons</small>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col [nzSpan]="24" [nzMd]="12">
              <nz-form-item>
                <nz-form-label>User ID</nz-form-label>
                <nz-form-control>
                  <input
                    nz-input
                    [value]="user.userId"
                    readonly
                    class="readonly-input"
                  />
                  <small class="form-text text-muted">Unique identifier for this user</small>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
        </div>

        <!-- Personal Information Section -->
        <div class="form-section">
          <h4 class="section-title">Personal Information</h4>
          <div nz-row [nzGutter]="24">
            <div nz-col [nzSpan]="24" [nzMd]="12">
              <nz-form-item>
                <nz-form-label>First Name</nz-form-label>
                <nz-form-control [nzErrorTip]="getFieldError('firstName')">
                  <input
                    nz-input
                    formControlName="firstName"
                    placeholder="Enter first name"
                    maxlength="100"
                  />
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col [nzSpan]="24" [nzMd]="12">
              <nz-form-item>
                <nz-form-label>Last Name</nz-form-label>
                <nz-form-control [nzErrorTip]="getFieldError('lastName')">
                  <input
                    nz-input
                    formControlName="lastName"
                    placeholder="Enter last name"
                    maxlength="100"
                  />
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
        </div>

        <!-- Account Status Section (Read-only info) -->
        <div class="form-section">
          <h4 class="section-title">Account Status</h4>
          <div nz-row [nzGutter]="24">
            <div nz-col [nzSpan]="24" [nzMd]="8">
              <div class="status-info">
                <span class="status-label">Account Status:</span>
                <nz-tag [nzColor]="user.isActive ? 'green' : 'red'" class="status-value">
                  {{ user.isActive ? 'Active' : 'Inactive' }}
                </nz-tag>
              </div>
            </div>
            <div nz-col [nzSpan]="24" [nzMd]="8">
              <div class="status-info">
                <span class="status-label">Email Verified:</span>
                <nz-tag [nzColor]="user.emailConfirmed ? 'green' : 'orange'" class="status-value">
                  {{ user.emailConfirmed ? 'Verified' : 'Pending' }}
                </nz-tag>
              </div>
            </div>
            <div nz-col [nzSpan]="24" [nzMd]="8">
              <div class="status-info">
                <span class="status-label">Roles:</span>
                <span class="status-value">{{ user.roles.length > 0 ? user.roles.join(', ') : 'No roles' }}</span>
              </div>
            </div>
          </div>
          <nz-alert
            nzType="info"
            nzMessage="Account Status Information"
            nzDescription="To change account status or manage roles, use the dedicated management tools from the user details page."
            [nzShowIcon]="true"
            class="status-alert"
          ></nz-alert>
        </div>

        <!-- Account Dates Section (Read-only) -->
        <div class="form-section">
          <h4 class="section-title">Account Timeline</h4>
          <div nz-row [nzGutter]="24">
            <div nz-col [nzSpan]="24" [nzMd]="8">
              <div class="date-info">
                <span class="date-label">Created:</span>
                <span class="date-value">{{ formatDate(user.createdAt) }}</span>
              </div>
            </div>
            <div nz-col [nzSpan]="24" [nzMd]="8">
              <div class="date-info">
                <span class="date-label">Last Updated:</span>
                <span class="date-value">{{ formatDate(user.updatedAt) }}</span>
              </div>
            </div>
            <div nz-col [nzSpan]="24" [nzMd]="8">
              <div class="date-info">
                <span class="date-label">Last Login:</span>
                <span class="date-value">{{ user.lastLoginAt ? formatDate(user.lastLoginAt) : 'Never' }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button
            nz-button
            nzType="default"
            nzSize="large"
            (click)="onCancel()"
            [disabled]="saving"
          >
            Cancel
          </button>
          <button
            nz-button
            nzType="primary"
            nzSize="large"
            [nzLoading]="saving"
            [disabled]="!editForm.valid || saving"
            type="submit"
          >
            <span *ngIf="!saving">Save Changes</span>
            <span *ngIf="saving">Saving...</span>
          </button>
        </div>
      </form>
    </nz-card>
  </div>

  <!-- Error State -->
  <div *ngIf="!loading && !user" class="error-state">
    <nz-result
      nzStatus="404"
      nzTitle="User Not Found"
      nzSubTitle="The user you're trying to edit doesn't exist or you don't have permission to edit it."
    >
      <div nz-result-extra>
        <button nz-button nzType="primary" (click)="goToUsersList()">Back to Users</button>
      </div>
    </nz-result>
  </div>
</div>
