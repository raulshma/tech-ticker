<nz-page-header
  class="site-page-header"
  [nzTitle]="isEditMode ? 'Edit Product' : 'Create Product'"
  nzBackIcon
  (nzBack)="onCancel()"
>
</nz-page-header>

<nz-card>
  <nz-spin [nzSpinning]="loading">
    <form nz-form [formGroup]="productForm" (ngSubmit)="onSubmit()" nzLayout="vertical">

      <div class="form-row">
        <!-- Product Name -->
        <nz-form-item class="form-item-half">
          <nz-form-label nzRequired nzFor="name">Product Name</nz-form-label>
          <nz-form-control
            nzHasFeedback
            [nzValidateStatus]="isFieldInvalid('name') ? 'error' : ''"
            [nzErrorTip]="getFieldError('name')"
          >
            <input
              nz-input
              formControlName="name"
              id="name"
              placeholder="Enter product name"
              maxlength="255"
            />
          </nz-form-control>
        </nz-form-item>

        <!-- SKU -->
        <nz-form-item class="form-item-half">
          <nz-form-label nzFor="sku">SKU</nz-form-label>
          <nz-form-control
            nzHasFeedback
            [nzValidateStatus]="isFieldInvalid('sku') ? 'error' : skuCheckLoading ? 'validating' : skuAvailable ? 'success' : 'error'"
            [nzErrorTip]="getFieldError('sku')"
          >
            <nz-input-group [nzSuffix]="skuSuffix">
              <input
                nz-input
                formControlName="sku"
                id="sku"
                placeholder="Product SKU (optional)"
                maxlength="100"
              />
            </nz-input-group>
            <ng-template #skuSuffix>
              <i
                nz-icon
                [nzType]="skuCheckLoading ? 'loading' : skuAvailable ? 'check-circle' : 'close-circle'"
                [nzTheme]="skuCheckLoading ? 'outline' : 'fill'"
                [style.color]="skuCheckLoading ? '#1890ff' : skuAvailable ? '#52c41a' : '#ff4d4f'"
                *ngIf="productForm.get('sku')?.value"
              ></i>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div class="form-row">
        <!-- Manufacturer -->
        <nz-form-item class="form-item-half">
          <nz-form-label nzFor="manufacturer">Manufacturer</nz-form-label>
          <nz-form-control
            [nzValidateStatus]="isFieldInvalid('manufacturer') ? 'error' : ''"
            [nzErrorTip]="getFieldError('manufacturer')"
          >
            <input
              nz-input
              formControlName="manufacturer"
              id="manufacturer"
              placeholder="Product manufacturer"
              maxlength="100"
            />
          </nz-form-control>
        </nz-form-item>

        <!-- Model Number -->
        <nz-form-item class="form-item-half">
          <nz-form-label nzFor="modelNumber">Model Number</nz-form-label>
          <nz-form-control
            [nzValidateStatus]="isFieldInvalid('modelNumber') ? 'error' : ''"
            [nzErrorTip]="getFieldError('modelNumber')"
          >
            <input
              nz-input
              formControlName="modelNumber"
              id="modelNumber"
              placeholder="Product model number"
              maxlength="100"
            />
          </nz-form-control>
        </nz-form-item>
      </div>

      <!-- Category -->
      <nz-form-item>
        <nz-form-label nzRequired nzFor="categoryId">Category</nz-form-label>
        <nz-form-control
          [nzValidateStatus]="isFieldInvalid('categoryId') ? 'error' : ''"
          [nzErrorTip]="getFieldError('categoryId')"
        >
          <nz-select
            formControlName="categoryId"
            id="categoryId"
            nzPlaceHolder="Select a category"
            [nzLoading]="categoriesLoading"
            nzShowSearch
            nzAllowClear
          >
            <nz-option
              *ngFor="let category of categories"
              [nzValue]="category.categoryId"
              [nzLabel]="category.name"
            ></nz-option>
          </nz-select>
          <div class="field-hint">
            <span>Choose the appropriate category for this product.</span>
            <button type="button" nz-button nzType="link" nzSize="small" (click)="navigateToCategories()">
              Manage Categories
            </button>
          </div>
        </nz-form-control>
      </nz-form-item>

      <!-- Description -->
      <nz-form-item>
        <nz-form-label nzFor="description">Description</nz-form-label>
        <nz-form-control
          [nzValidateStatus]="isFieldInvalid('description') ? 'error' : ''"
          [nzErrorTip]="getFieldError('description')"
        >
          <textarea
            nz-input
            formControlName="description"
            id="description"
            placeholder="Product description"
            rows="4"
          ></textarea>
        </nz-form-control>
      </nz-form-item>

      <!-- Specifications -->
      <nz-form-item>
        <nz-form-label nzFor="specifications">Specifications</nz-form-label>
        <nz-form-control
          [nzValidateStatus]="isFieldInvalid('specifications') ? 'error' : ''"
          [nzErrorTip]="getFieldError('specifications')"
        >
          <textarea
            nz-input
            formControlName="specifications"
            id="specifications"
            placeholder="Technical specifications (JSON format or plain text)"
            rows="6"
          ></textarea>
          <div class="field-hint">
            You can enter specifications in JSON format or as plain text.
          </div>
        </nz-form-control>
      </nz-form-item>

      <!-- Status -->
      <nz-form-item>
        <nz-form-label nzFor="isActive">Status</nz-form-label>
        <nz-form-control>
          <nz-switch
            formControlName="isActive"
            id="isActive"
            nzCheckedChildren="Active"
            nzUnCheckedChildren="Inactive"
          ></nz-switch>
          <div class="field-hint">
            Inactive products will not be visible in public listings.
          </div>
        </nz-form-control>
      </nz-form-item>

      <!-- Form Actions -->
      <nz-form-item class="form-actions">
        <nz-form-control>
          <button
            nz-button
            nzType="primary"
            nzSize="large"
            [nzLoading]="loading"
            [disabled]="!productForm.valid || !skuAvailable"
            type="submit"
          >
            <i nz-icon [nzType]="isEditMode ? 'save' : 'plus'"></i>
            {{ isEditMode ? 'Update Product' : 'Create Product' }}
          </button>

          <button
            nz-button
            nzType="default"
            nzSize="large"
            type="button"
            (click)="onCancel()"
            [disabled]="loading"
            class="cancel-button"
          >
            Cancel
          </button>
        </nz-form-control>
      </nz-form-item>

    </form>
  </nz-spin>
</nz-card>
