<nz-page-header
  class="site-page-header"
  [nzTitle]="product?.name || 'Product Details'"
  nzBackIcon
  (nzBack)="goBack()"
>
  <nz-page-header-extra>
    <nz-button-group>
      <button
        nz-button
        nzType="default"
        (click)="editProduct()"
        [disabled]="!product"
      >
        <i nz-icon nzType="edit"></i>
        Edit
      </button>
      <button
        nz-button
        [nzType]="product?.isActive ? 'default' : 'primary'"
        (click)="toggleProductStatus()"
        [disabled]="!product"
      >
        <i nz-icon [nzType]="product?.isActive ? 'pause' : 'play-circle'"></i>
        {{ product?.isActive ? 'Deactivate' : 'Activate' }}
      </button>
      <button
        nz-button
        nzType="primary"
        nzDanger
        (click)="deleteProduct()"
        [disabled]="!product"
      >
        <i nz-icon nzType="delete"></i>
        Delete
      </button>
    </nz-button-group>
  </nz-page-header-extra>
</nz-page-header>

<nz-spin [nzSpinning]="loading">
  <div class="product-details" *ngIf="product">

    <!-- Basic Information Card -->
    <nz-card nzTitle="Basic Information" class="info-card">
      <nz-descriptions nzBordered [nzColumn]="2">
        <nz-descriptions-item nzTitle="Product Name" [nzSpan]="2">
          <strong>{{ product.name }}</strong>
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="SKU" [nzSpan]="1">
          <nz-tag *ngIf="product.sku" nzColor="blue">{{ product.sku }}</nz-tag>
          <span *ngIf="!product.sku" class="text-muted">No SKU</span>
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Status" [nzSpan]="1">
          <nz-tag [nzColor]="product.isActive ? 'success' : 'default'">
            {{ product.isActive ? 'Active' : 'Inactive' }}
          </nz-tag>
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Manufacturer" [nzSpan]="1">
          <span *ngIf="product.manufacturer; else noManufacturer">{{ product.manufacturer }}</span>
          <ng-template #noManufacturer>
            <span class="text-muted">Not specified</span>
          </ng-template>
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Model Number" [nzSpan]="1">
          <span *ngIf="product.modelNumber; else noModel">{{ product.modelNumber }}</span>
          <ng-template #noModel>
            <span class="text-muted">Not specified</span>
          </ng-template>
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Category" [nzSpan]="2">
          <nz-tag nzColor="green" (click)="viewCategory()" class="clickable-tag">
            {{ product.categoryName }}
          </nz-tag>
        </nz-descriptions-item>
      </nz-descriptions>
    </nz-card>

    <!-- Description Card -->
    <nz-card nzTitle="Description" class="info-card" *ngIf="product.description">
      <div class="description-content">
        {{ product.description }}
      </div>
    </nz-card>

    <!-- Specifications Card -->
    <nz-card nzTitle="Specifications" class="info-card" *ngIf="product.specifications">
      <div class="specifications-content">
        <div *ngIf="isJsonString(product.specifications); else plainText">
          <nz-descriptions nzBordered [nzColumn]="1">
            <nz-descriptions-item
              *ngFor="let spec of formatSpecifications(product.specifications) | keyvalue"
              [nzTitle]="spec.key"
            >
              {{ spec.value }}
            </nz-descriptions-item>
          </nz-descriptions>
        </div>
        <ng-template #plainText>
          <pre class="specifications-text">{{ product.specifications }}</pre>
        </ng-template>
      </div>
    </nz-card>

    <!-- Metadata Card -->
    <nz-card nzTitle="Metadata" class="info-card">
      <nz-descriptions nzBordered [nzColumn]="2">
        <nz-descriptions-item nzTitle="Product ID" [nzSpan]="2">
          <code>{{ product.productId }}</code>
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Category ID" [nzSpan]="2">
          <code>{{ product.categoryId }}</code>
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Created At" [nzSpan]="1">
          {{ formatDate(product.createdAt) }}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Last Updated" [nzSpan]="1">
          {{ formatDate(product.updatedAt) }}
        </nz-descriptions-item>
      </nz-descriptions>
    </nz-card>

    <!-- Actions Card -->
    <nz-card nzTitle="Quick Actions" class="actions-card">
      <div class="action-buttons">
        <button
          nz-button
          nzType="default"
          nzSize="large"
          (click)="viewCategory()"
        >
          <i nz-icon nzType="tag"></i>
          View Category
        </button>

        <button
          nz-button
          nzType="primary"
          nzSize="large"
          (click)="editProduct()"
        >
          <i nz-icon nzType="edit"></i>
          Edit Product
        </button>

        <button
          nz-button
          [nzType]="product.isActive ? 'default' : 'primary'"
          nzSize="large"
          (click)="toggleProductStatus()"
        >
          <i nz-icon [nzType]="product.isActive ? 'pause' : 'play-circle'"></i>
          {{ product.isActive ? 'Deactivate' : 'Activate' }} Product
        </button>

        <button
          nz-button
          nzType="default"
          nzSize="large"
          nzDanger
          (click)="deleteProduct()"
        >
          <i nz-icon nzType="delete"></i>
          Delete Product
        </button>
      </div>
    </nz-card>

  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <nz-spin nzSize="large">
      <ng-template #loadingTemplate>
        <div class="loading-text">Loading product details...</div>
      </ng-template>
    </nz-spin>
  </div>

</nz-spin>
