<nz-page-header
  class="site-page-header"
  [nzTitle]="isEditMode ? 'Edit Category' : 'Create Category'"
  nzBackIcon
  (nzBack)="onCancel()"
>
</nz-page-header>

<nz-card>
  <nz-spin [nzSpinning]="loading">
    <form
      nz-form
      [formGroup]="categoryForm"
      (ngSubmit)="onSubmit()"
      nzLayout="vertical"
    >
      <!-- Category Name -->
      <nz-form-item>
        <nz-form-label nzRequired nzFor="name">Category Name</nz-form-label>
        <nz-form-control
          nzHasFeedback
          [nzValidateStatus]="isFieldInvalid('name') ? 'error' : ''"
          [nzErrorTip]="getFieldError('name')"
        >
          <input
            nz-input
            formControlName="name"
            id="name"
            placeholder="Enter category name"
            maxlength="100"
          />
          <div class="field-hint">
            This will be displayed as the category name throughout the
            application.
          </div>
        </nz-form-control>
      </nz-form-item>

      <!-- Category Slug -->
      <nz-form-item>
        <nz-form-label nzRequired nzFor="slug">
          URL Slug
          <span class="slug-controls">
            <button
              type="button"
              nz-button
              nzType="link"
              nzSize="small"
              (click)="regenerateSlug()"
              nz-tooltip="Regenerate from name"
            >
              <i nz-icon nzType="reload"></i>
            </button>
          </span>
        </nz-form-label>
        <nz-form-control
          nzHasFeedback
          [nzValidateStatus]="
            isFieldInvalid('slug')
              ? 'error'
              : slugCheckLoading
              ? 'validating'
              : slugAvailable
              ? 'success'
              : 'error'
          "
          [nzErrorTip]="getFieldError('slug')"
        >
          <nz-input-group [nzSuffix]="slugSuffix">
            <input
              nz-input
              formControlName="slug"
              id="slug"
              placeholder="category-url-slug"
              maxlength="100"
              (input)="onSlugManualEdit()"
            />
          </nz-input-group>
          <ng-template #slugSuffix>
            <i
              nz-icon
              [nzType]="
                slugCheckLoading
                  ? 'loading'
                  : slugAvailable
                  ? 'check-circle'
                  : 'close-circle'
              "
              [nzTheme]="slugCheckLoading ? 'outline' : 'fill'"
              [style.color]="
                slugCheckLoading
                  ? '#1890ff'
                  : slugAvailable
                  ? '#52c41a'
                  : '#ff4d4f'
              "
            ></i>
          </ng-template>
          <div class="field-hint">
            Used in URLs. Only lowercase letters, numbers, and hyphens allowed.
            <span *ngIf="autoGenerateSlug" class="auto-generate-hint">
              <i nz-icon nzType="info-circle"></i>
              Auto-generated from name
            </span>
          </div>
        </nz-form-control>
      </nz-form-item>

      <!-- Description -->
      <nz-form-item>
        <nz-form-label nzFor="description">Description</nz-form-label>
        <nz-form-control
          [nzValidateStatus]="isFieldInvalid('description') ? 'error' : ''"
          [nzErrorTip]="getFieldError('description')"
        >
          <textarea
            nz-input
            formControlName="description"
            id="description"
            placeholder="Optional description for this category"
            rows="4"
            maxlength="500"
          ></textarea>
          <div class="field-hint">
            Optional description to help users understand what products belong
            in this category.
          </div>
        </nz-form-control>
      </nz-form-item>

      <!-- Form Actions -->
      <nz-form-item class="form-actions">
        <nz-form-control>
          <button
            nz-button
            nzType="primary"
            nzSize="large"
            [nzLoading]="loading"
            [disabled]="!categoryForm.valid || !slugAvailable"
            type="submit"
          >
            <i nz-icon [nzType]="isEditMode ? 'save' : 'plus'"></i>
            {{ isEditMode ? "Update Category" : "Create Category" }}
          </button>

          <button
            nz-button
            nzType="default"
            nzSize="large"
            type="button"
            (click)="onCancel()"
            [disabled]="loading"
            class="cancel-button"
          >
            Cancel
          </button>
        </nz-form-control>
      </nz-form-item>
    </form>
  </nz-spin>
</nz-card>

<!-- Form Validation Summary -->
<nz-card
  *ngIf="categoryForm.invalid && categoryForm.touched"
  class="validation-summary"
>
  <nz-alert
    nzType="error"
    nzMessage="Please fix the following errors:"
    nzShowIcon
  >
    <ul class="error-list">
      <li *ngIf="getFieldError('name')">{{ getFieldError("name") }}</li>
      <li *ngIf="getFieldError('slug')">{{ getFieldError("slug") }}</li>
      <li *ngIf="getFieldError('description')">
        {{ getFieldError("description") }}
      </li>
    </ul>
  </nz-alert>
</nz-card>
