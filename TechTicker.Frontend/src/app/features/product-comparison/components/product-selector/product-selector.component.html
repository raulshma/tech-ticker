<div class="product-selector">
  <mat-form-field class="full-width" appearance="outline">
    <mat-label>{{ label }}</mat-label>
    <input
      matInput
      [formControl]="searchControl"
      [matAutocomplete]="auto"
      [placeholder]="placeholder"
      [required]="required"
      [disabled]="disabled">

    <button
      *ngIf="selectedProduct && selectedProduct.productId"
      matSuffix
      mat-icon-button
      (click)="clearSelection()"
      type="button"
      matTooltip="Clear selection">
      <mat-icon>clear</mat-icon>
    </button>

    <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayProductName">
      <mat-option
        *ngFor="let product of options"
        [value]="product"
        (onSelectionChange)="onProductSelected(product)"
        class="product-option">

        <div class="product-option-content">
          <div class="product-image">
            <app-image-gallery
              *ngIf="hasProductImages(product)"
              [primaryImageUrl]="getPrimaryImageUrl(product)"
              [additionalImageUrls]="getAdditionalImageUrls(product)"
              [altText]="product.name || 'Product image'"
              [maxHeight]="'60px'"
              [maxWidth]="'60px'"
              [showThumbnails]="false">
            </app-image-gallery>

            <div *ngIf="!hasProductImages(product)"
                 class="no-image-placeholder">
              <mat-icon>image_not_supported</mat-icon>
            </div>
          </div>

          <div class="product-info">
            <div class="product-name">
              <span class="manufacturer">{{ product.manufacturer }}</span>
              <span class="name">{{ product.name }}</span>
            </div>
            <div class="product-meta">
              <span class="category">{{ getProductCategory(product) }}</span>
              <span class="model" *ngIf="product.modelNumber">
                Model: {{ product.modelNumber }}
              </span>
            </div>
          </div>

          <div class="product-status">
            <mat-chip
              [color]="product.isActive ? 'primary' : 'accent'"
              selected>
              {{ product.isActive ? 'Active' : 'Inactive' }}
            </mat-chip>
          </div>
        </div>
      </mat-option>

      <mat-option *ngIf="options.length === 0 && searchControl.value" disabled>
        <div class="no-results">
          <mat-icon>search_off</mat-icon>
          <span>No products found</span>
        </div>
      </mat-option>
    </mat-autocomplete>
  </mat-form-field>

  <!-- Selected Product Display -->
  <div *ngIf="selectedProduct && selectedProduct.productId" class="selected-product">
    <mat-card class="product-card">
      <div class="product-card-content">
        <div class="product-image-large">
          <app-image-gallery
            *ngIf="hasProductImages(selectedProduct)"
            [primaryImageUrl]="getPrimaryImageUrl(selectedProduct)"
            [additionalImageUrls]="getAdditionalImageUrls(selectedProduct)"
            [altText]="selectedProduct.name || 'Product image'"
            [maxHeight]="'200px'"
            [showThumbnails]="false">
          </app-image-gallery>

          <div *ngIf="!hasProductImages(selectedProduct)"
               class="no-image-placeholder-large">
            <mat-icon>image_not_supported</mat-icon>
            <span>No image available</span>
          </div>
        </div>

        <div class="product-details">
          <h3 class="product-title">
            {{ selectedProduct.manufacturer }} {{ selectedProduct.name }}
          </h3>

          <div class="product-metadata">
            <div class="meta-item">
              <mat-icon>category</mat-icon>
              <span>{{ getProductCategory(selectedProduct) }}</span>
            </div>

            <div class="meta-item" *ngIf="selectedProduct.modelNumber">
              <mat-icon>confirmation_number</mat-icon>
              <span>{{ selectedProduct.modelNumber }}</span>
            </div>

            <div class="meta-item" *ngIf="selectedProduct.description">
              <mat-icon>description</mat-icon>
              <span class="description">{{ selectedProduct.description }}</span>
            </div>
          </div>

          <div class="product-specs" *ngIf="hasSpecifications(selectedProduct)">
            <h4>Key Specifications</h4>
            <div class="specs-grid">
              <div
                *ngFor="let spec of getKeySpecs(selectedProduct)"
                class="spec-item">
                <span class="spec-label">{{ spec.key }}:</span>
                <span class="spec-value">{{ spec.value }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-card>
  </div>
</div>
