<div class="scraper-log-detail-container">
  <!-- Modern Header Section -->
  <header class="detail-header-section">
    <div class="header-content">
      <div class="header-main">
        <div class="back-navigation">
          <button matIconButton (click)="goBack()" matTooltip="Back to Logs">
            <mat-icon>arrow_back</mat-icon>
          </button>
        </div>
        <div class="title-section">
          <h1 class="mat-display-small">Scraper Log Details</h1>
          <p class="mat-body-large header-subtitle" *ngIf="scraperLog">
            Run ID: <code>{{ scraperLog.runId }}</code>
          </p>
        </div>
        <div class="header-actions" *ngIf="scraperLog">
          <button matIconButton (click)="copyToClipboard(scraperLog.runId!)" matTooltip="Copy Run ID">
            <mat-icon>content_copy</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container" role="status" aria-live="polite">
    <mat-spinner diameter="48" strokeWidth="4"></mat-spinner>
    <p class="mat-body-large loading-text">Loading scraper log details...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && scraperLog" class="content-section">
    <div class="content-grid">

      <!-- Status Overview Card -->
      <mat-card class="status-overview-card" appearance="outlined">
        <mat-card-header>
          <div class="status-header-content">
            <div class="status-icon-container" [class]="'status-' + getStatusColor(scraperLog.status)">
              <mat-icon>{{ getStatusIcon(scraperLog.status) }}</mat-icon>
            </div>
            <div class="status-text">
              <mat-card-title class="mat-headline-medium">{{ scraperLog.statusDisplayName || scraperLog.status }}</mat-card-title>
              <mat-card-subtitle class="mat-body-medium">Execution Status</mat-card-subtitle>
            </div>
          </div>
        </mat-card-header>
        <mat-card-content>
          <div class="status-metrics">
            <div class="metric-item">
              <span class="metric-label">Started</span>
              <span class="metric-value">{{ formatDate(scraperLog.startedAt) }}</span>
            </div>
            <div class="metric-item" *ngIf="scraperLog.completedAt">
              <span class="metric-label">Completed</span>
              <span class="metric-value">{{ formatDate(scraperLog.completedAt) }}</span>
            </div>
            <div class="metric-item" *ngIf="scraperLog.duration">
              <span class="metric-label">Duration</span>
              <span class="metric-value">{{ formatDuration(scraperLog.duration) }}</span>
            </div>
            <div class="metric-item" *ngIf="scraperLog.attemptNumber">
              <span class="metric-label">Attempt</span>
              <span class="metric-value">#{{ scraperLog.attemptNumber }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Basic Information -->
      <mat-card class="info-card basic-info" appearance="outlined">
        <mat-card-header>
          <mat-card-title class="mat-headline-small">
            <mat-icon>info</mat-icon>
            Basic Information
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="info-grid">
            <div class="info-item">
              <label class="info-label">Mapping ID</label>
              <div class="info-value-container">
                <span class="info-value">{{ scraperLog.mappingId }}</span>
                <button matIconButton (click)="copyToClipboard(scraperLog.mappingId!)" 
                        matTooltip="Copy Mapping ID">
                  <mat-icon>content_copy</mat-icon>
                </button>
              </div>
            </div>

            <div class="info-item" *ngIf="scraperLog.httpStatusCode">
              <label class="info-label">HTTP Status</label>
              <div class="info-value-container">
                <mat-chip [class]="getHttpStatusClass(scraperLog.httpStatusCode)">
                  {{ scraperLog.httpStatusCode }}
                </mat-chip>
              </div>
            </div>

            <div class="info-item" *ngIf="scraperLog.responseTime">
              <label class="info-label">Response Time</label>
              <span class="info-value">{{ formatDuration(scraperLog.responseTime) }}</span>
            </div>

            <div class="info-item" *ngIf="scraperLog.responseSizeBytes">
              <label class="info-label">Response Size</label>
              <span class="info-value">{{ formatBytes(scraperLog.responseSizeBytes) }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Target Information -->
      <mat-card class="info-card target-info" appearance="outlined">
        <mat-card-header>
          <mat-card-title class="mat-headline-small">
            <mat-icon>language</mat-icon>
            Target Information
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="info-grid">
            <div class="info-item full-width">
              <label class="info-label">Target URL</label>
              <div class="url-display">
                <span class="url-text">{{ scraperLog.targetUrl }}</span>
                <div class="url-actions">
                  <button matIconButton (click)="copyToClipboard(scraperLog.targetUrl!)" 
                          matTooltip="Copy URL">
                    <mat-icon>content_copy</mat-icon>
                  </button>
                  <button matIconButton (click)="openUrl(scraperLog.targetUrl!)" 
                          matTooltip="Open URL">
                    <mat-icon>open_in_new</mat-icon>
                  </button>
                </div>
              </div>
            </div>

            <div class="info-item full-width" *ngIf="scraperLog.userAgent">
              <label class="info-label">User Agent</label>
              <div class="user-agent-display">
                <span class="user-agent-text">{{ scraperLog.userAgent }}</span>
                <button matIconButton (click)="copyToClipboard(scraperLog.userAgent!)" 
                        matTooltip="Copy User Agent">
                  <mat-icon>content_copy</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Proxy Information -->
      <mat-card class="info-card proxy-info" appearance="outlined" *ngIf="hasProxyData()">
        <mat-card-header>
          <mat-card-title class="mat-headline-small">
            <mat-icon>security</mat-icon>
            Proxy Information
          </mat-card-title>
          <mat-card-subtitle>Network proxy configuration used</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="info-grid">
            <div class="info-item" *ngIf="scraperLog?.proxyUsed">
              <label class="info-label">Proxy Server</label>
              <div class="proxy-display">
                <mat-chip class="proxy-chip">
                  <mat-icon matChipAvatar>security</mat-icon>
                  {{ scraperLog.proxyUsed }}
                </mat-chip>
                <button matIconButton (click)="copyToClipboard(scraperLog.proxyUsed!)" 
                        matTooltip="Copy Proxy">
                  <mat-icon>content_copy</mat-icon>
                </button>
              </div>
            </div>

            <div class="info-item" *ngIf="scraperLog.proxyId">
              <label class="info-label">Proxy ID</label>
              <div class="info-value-container">
                <code class="proxy-id">{{ scraperLog.proxyId }}</code>
                <button matIconButton (click)="copyToClipboard(scraperLog.proxyId!)" 
                        matTooltip="Copy Proxy ID">
                  <mat-icon>content_copy</mat-icon>
                </button>
              </div>
            </div>

            <div class="info-item direct-connection" *ngIf="!scraperLog.proxyUsed && !scraperLog.proxyId">
              <label class="info-label">Connection Type</label>
              <div class="direct-connection-display">
                <mat-chip class="direct-chip">
                  <mat-icon matChipAvatar>wifi</mat-icon>
                  Direct Connection
                </mat-chip>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Extracted Data -->
      <mat-card class="info-card extracted-data" appearance="outlined" 
                *ngIf="scraperLog.extractedProductName || scraperLog.extractedPrice || scraperLog.extractedStockStatus || scraperLog.extractedSellerName">
        <mat-card-header>
          <mat-card-title class="mat-headline-small">
            <mat-icon>data_object</mat-icon>
            Extracted Data
          </mat-card-title>
          <mat-card-subtitle>Successfully scraped information</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="extracted-data-grid">
            <div class="data-item" *ngIf="scraperLog.extractedProductName">
              <div class="data-icon">
                <mat-icon>shopping_bag</mat-icon>
              </div>
              <div class="data-content">
                <label class="data-label">Product Name</label>
                <span class="data-value">{{ scraperLog.extractedProductName }}</span>
              </div>
            </div>

            <div class="data-item" *ngIf="scraperLog.extractedPrice">
              <div class="data-icon">
                <mat-icon>attach_money</mat-icon>
              </div>
              <div class="data-content">
                <label class="data-label">Price</label>
                <span class="data-value price-value">${{ scraperLog.extractedPrice }}</span>
              </div>
            </div>

            <div class="data-item" *ngIf="scraperLog.extractedStockStatus">
              <div class="data-icon">
                <mat-icon>inventory</mat-icon>
              </div>
              <div class="data-content">
                <label class="data-label">Stock Status</label>
                <mat-chip class="stock-chip">{{ scraperLog.extractedStockStatus }}</mat-chip>
              </div>
            </div>

            <div class="data-item" *ngIf="scraperLog.extractedSellerName">
              <div class="data-icon">
                <mat-icon>store</mat-icon>
              </div>
              <div class="data-content">
                <label class="data-label">Seller</label>
                <span class="data-value">{{ scraperLog.extractedSellerName }}</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Image Extraction Results -->
      <mat-card class="info-card image-results" appearance="outlined" *ngIf="hasImageData()">
        <mat-card-header>
          <mat-card-title class="mat-headline-small">
            <mat-icon>image</mat-icon>
            Image Extraction
          </mat-card-title>
          <mat-card-subtitle>Image processing and upload results</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="image-stats">
            <div class="image-stat" *ngIf="scraperLog.imageProcessingCount !== null && scraperLog.imageProcessingCount !== undefined">
              <div class="stat-icon processed">
                <mat-icon>image_search</mat-icon>
              </div>
              <div class="stat-content">
                <span class="stat-number">{{ scraperLog.imageProcessingCount }}</span>
                <span class="stat-label">Processed</span>
              </div>
            </div>

            <div class="image-stat" *ngIf="scraperLog.imageUploadCount !== null && scraperLog.imageUploadCount !== undefined">
              <div class="stat-icon uploaded">
                <mat-icon>cloud_upload</mat-icon>
              </div>
              <div class="stat-content">
                <span class="stat-number">{{ scraperLog.imageUploadCount }}</span>
                <span class="stat-label">Uploaded</span>
              </div>
            </div>
          </div>

          <div class="image-urls" *ngIf="scraperLog.extractedPrimaryImageUrl || (scraperLog.extractedAdditionalImageUrls && scraperLog.extractedAdditionalImageUrls.length > 0)">
            <div class="primary-image" *ngIf="scraperLog.extractedPrimaryImageUrl">
              <label class="image-label">Primary Image</label>
              <div class="image-url-item">
                <span class="url-display">{{ scraperLog.extractedPrimaryImageUrl }}</span>
                <div class="image-actions">
                  <button matIconButton (click)="copyToClipboard(scraperLog.extractedPrimaryImageUrl!)" 
                          matTooltip="Copy URL">
                    <mat-icon>content_copy</mat-icon>
                  </button>
                  <button matIconButton (click)="openUrl(scraperLog.extractedPrimaryImageUrl!)" 
                          matTooltip="View Image">
                    <mat-icon>visibility</mat-icon>
                  </button>
                </div>
              </div>
            </div>

            <div class="additional-images" *ngIf="scraperLog.extractedAdditionalImageUrls && scraperLog.extractedAdditionalImageUrls.length > 0">
              <label class="image-label">Additional Images ({{ scraperLog.extractedAdditionalImageUrls.length }})</label>
              <div class="additional-images-list">
                <div *ngFor="let imageUrl of scraperLog.extractedAdditionalImageUrls; let i = index" 
                     class="image-url-item">
                  <span class="image-index">{{ i + 1 }}.</span>
                  <span class="url-display">{{ imageUrl }}</span>
                  <div class="image-actions">
                    <button matIconButton (click)="copyToClipboard(imageUrl)" 
                            matTooltip="Copy URL">
                      <mat-icon>content_copy</mat-icon>
                    </button>
                    <button matIconButton (click)="openUrl(imageUrl)" 
                            matTooltip="View Image">
                      <mat-icon>visibility</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Error Information -->
      <mat-card class="info-card error-info" appearance="outlined" *ngIf="scraperLog.errorMessage">
        <mat-card-header>
          <mat-card-title class="mat-headline-small error-title">
            <mat-icon>error</mat-icon>
            Error Details
          </mat-card-title>
          <mat-card-subtitle>Error information and diagnostic details</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="error-display">
            <div class="error-content">
              <pre class="error-message">{{ scraperLog.errorMessage }}</pre>
              <button matIconButton (click)="copyToClipboard(scraperLog.errorMessage!)" 
                      matTooltip="Copy Error Message">
                <mat-icon>content_copy</mat-icon>
              </button>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && !scraperLog" class="error-state-container">
    <div class="error-state-content">
      <mat-icon class="error-state-icon">error_outline</mat-icon>
      <h2 class="mat-headline-medium">Log Not Found</h2>
      <p class="mat-body-large">The requested scraper log could not be found or may have been deleted.</p>
      <button matButton="filled" color="primary" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        Back to Logs
      </button>
    </div>
  </div>
</div>
