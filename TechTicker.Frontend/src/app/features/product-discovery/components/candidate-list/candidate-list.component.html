<div class="candidate-list-container">
  <div class="list-header">
    <h2>Discovery Candidates</h2>
    <p>Review and manage product discovery candidates awaiting approval.</p>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <form [formGroup]="filterForm" class="filters-form">
      <div class="row">
        <div class="col-md-3">
          <label for="status">Status</label>
          <select id="status" class="form-control" formControlName="status">
            <option *ngFor="let option of statusOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>
        <div class="col-md-3">
          <label for="searchTerm">Search</label>
          <input type="text" id="searchTerm" class="form-control"
                 formControlName="searchTerm" placeholder="Product name...">
        </div>
        <div class="col-md-3">
          <label for="discoveredAfter">From Date</label>
          <input type="date" id="discoveredAfter" class="form-control" formControlName="discoveredAfter">
        </div>
        <div class="col-md-3">
          <label for="discoveredBefore">To Date</label>
          <input type="date" id="discoveredBefore" class="form-control" formControlName="discoveredBefore">
        </div>
      </div>
      <div class="filter-actions">
        <button type="button" class="btn btn-secondary" (click)="onClearFilters()">
          <i class="fas fa-times mr-1"></i>
          Clear Filters
        </button>
        <button type="button" class="btn btn-primary" (click)="onRefresh()">
          <i class="fas fa-sync-alt mr-1"></i>
          Refresh
        </button>
      </div>
    </form>
  </div>

  <!-- Results Summary -->
  <div class="results-summary">
    <span class="total-count">{{ totalCount }} candidates found</span>
    <div class="page-size-selector">
      <label>Show:</label>
      <select class="form-control form-control-sm" [value]="pageSize" (change)="onPageSizeChange($event)">
        <option value="10">10</option>
        <option value="25">25</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>
      <span>per page</span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="sr-only">Loading...</span>
    </div>
    <p>Loading candidates...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="alert alert-danger">
    <i class="fas fa-exclamation-triangle mr-2"></i>
    {{ error }}
  </div>

  <!-- Candidates Table -->
  <div *ngIf="!isLoading && !error" class="candidates-table-container">
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Product</th>
            <th>Source</th>
            <th>Category</th>
            <th>Confidence</th>
            <th>Status</th>
            <th>Discovered</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let candidate of candidates">
            <td>
              <div class="product-info">
                <div class="product-name">{{ candidate.extractedProductName }}</div>
                <div *ngIf="candidate.extractedManufacturer" class="product-manufacturer">
                  {{ candidate.extractedManufacturer }}
                </div>
                <div *ngIf="candidate.extractedPrice" class="product-price">
                  ${{ candidate.extractedPrice | number:'1.2-2' }}
                </div>
              </div>
            </td>
            <td>
              <a [href]="candidate.sourceUrl" target="_blank" class="source-link">
                {{ candidate.sourceUrl | slice:0:50 }}{{ getSourceUrlLength(candidate.sourceUrl) > 50 ? '...' : '' }}
                <i class="fas fa-external-link-alt ml-1"></i>
              </a>
            </td>
            <td>
              <span *ngIf="candidate.suggestedCategory">
                {{ candidate.suggestedCategory.name }}
              </span>
              <span *ngIf="!candidate.suggestedCategory" class="text-muted">
                No suggestion
              </span>
            </td>
            <td>
              <span [ngClass]="getConfidenceClass(candidate.categoryConfidenceScore)">
                {{ (getConfidenceScore(candidate.categoryConfidenceScore) * 100) | number:'1.0-0' }}%
              </span>
            </td>
            <td>
              <span class="badge" [ngClass]="getStatusBadgeClass(candidate.status)">
                {{ candidate.status }}
              </span>
            </td>
            <td>
              <div class="discovery-info">
                <div>{{ candidate.discoveredAt | date:'short' }}</div>
                <small class="text-muted">{{ candidate.discoveryMethod }}</small>
              </div>
            </td>
            <td>
              <div class="action-buttons">
                <a [routerLink]="['/product-discovery/candidates', candidate.candidateId]"
                   class="btn btn-sm btn-outline-primary">
                  <i class="fas fa-eye"></i>
                </a>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div *ngIf="candidates.length === 0" class="empty-state">
      <i class="fas fa-search fa-3x text-muted"></i>
      <h4>No candidates found</h4>
      <p>Try adjusting your filters or analyze some URLs to create new candidates.</p>
      <a routerLink="/product-discovery/analyze" class="btn btn-primary">
        <i class="fas fa-plus mr-2"></i>
        Analyze URL
      </a>
    </div>
  </div>

  <!-- Pagination -->
  <nav *ngIf="totalPages > 1" class="pagination-container">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" (click)="onPageChange(currentPage - 1)" [attr.aria-disabled]="currentPage === 1">
          <i class="fas fa-chevron-left"></i>
        </a>
      </li>

      <li *ngIf="currentPage > 3" class="page-item">
        <a class="page-link" (click)="onPageChange(1)">1</a>
      </li>
      <li *ngIf="currentPage > 4" class="page-item disabled">
        <span class="page-link">...</span>
      </li>

      <li *ngFor="let page of getPaginationArray()"
          class="page-item" [class.active]="page === currentPage">
        <a class="page-link" (click)="onPageChange(page)">{{ page }}</a>
      </li>

      <li *ngIf="currentPage < totalPages - 3" class="page-item disabled">
        <span class="page-link">...</span>
      </li>
      <li *ngIf="currentPage < totalPages - 2" class="page-item">
        <a class="page-link" (click)="onPageChange(totalPages)">{{ totalPages }}</a>
      </li>

      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <a class="page-link" (click)="onPageChange(currentPage + 1)" [attr.aria-disabled]="currentPage === totalPages">
          <i class="fas fa-chevron-right"></i>
        </a>
      </li>
    </ul>
  </nav>
</div>
