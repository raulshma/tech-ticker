<mat-sidenav-container class="sidenav-container">
  <!-- Sidebar -->
  <mat-sidenav #drawer class="sidenav" fixedInViewport="true" mode="side" opened="true">
    <!-- Brand Header -->
    <div class="sidenav-header">
      <div class="brand-container">
        <mat-icon class="brand-icon">trending_up</mat-icon>
        <div class="brand-text">
          <span class="brand-title">TechTicker</span>
          <span class="brand-subtitle">Price Tracker</span>
        </div>
      </div>
    </div>

    <!-- Navigation Content -->
    <div class="nav-content">
      <nav class="primary-nav">
        <!-- Main Navigation -->
        <div class="nav-section">
          <a mat-list-item 
             class="nav-item" 
             routerLink="/dashboard" 
             routerLinkActive="active-link" 
             [routerLinkActiveOptions]="{exact: true}">
            <div class="nav-item-content">
              <mat-icon class="nav-icon">dashboard</mat-icon>
              <span class="nav-label">Dashboard</span>
            </div>
            <div class="state-layer"></div>
          </a>

          <a mat-list-item 
             class="nav-item" 
             routerLink="/catalog" 
             routerLinkActive="active-link">
            <div class="nav-item-content">
              <mat-icon class="nav-icon">storefront</mat-icon>
              <span class="nav-label">Product Catalog</span>
            </div>
            <div class="state-layer"></div>
          </a>
        </div>

        <!-- Admin and Moderator sections -->
        <ng-container *hasAnyRole="['Admin', 'Moderator']">
          <div class="nav-section">
            <h3 class="section-header">Product Management</h3>
            
            <a mat-list-item 
               class="nav-item" 
               routerLink="/categories" 
               routerLinkActive="active-link">
              <div class="nav-item-content">
                <mat-icon class="nav-icon">category</mat-icon>
                <span class="nav-label">Categories</span>
              </div>
              <div class="state-layer"></div>
            </a>

            <a mat-list-item 
               class="nav-item" 
               routerLink="/products" 
               routerLinkActive="active-link">
              <div class="nav-item-content">
                <mat-icon class="nav-icon">inventory</mat-icon>
                <span class="nav-label">Products</span>
              </div>
              <div class="state-layer"></div>
            </a>
          </div>
        </ng-container>

        <!-- Admin-only sections -->
        <ng-container *hasRole="'Admin'">
          <div class="nav-section">
            <a mat-list-item 
               class="nav-item" 
               routerLink="/site-configs" 
               routerLinkActive="active-link">
              <div class="nav-item-content">
                <mat-icon class="nav-icon">settings</mat-icon>
                <span class="nav-label">Site Configurations</span>
              </div>
              <div class="state-layer"></div>
            </a>
          </div>

          <div class="nav-section">
            <h3 class="section-header">Infrastructure</h3>
            
            <a mat-list-item 
               class="nav-item" 
               routerLink="/admin/proxies" 
               routerLinkActive="active-link" 
               *hasPermission="'Proxies.Read'">
              <div class="nav-item-content">
                <mat-icon class="nav-icon">vpn_lock</mat-icon>
                <span class="nav-label">Proxy Management</span>
              </div>
              <div class="state-layer"></div>
            </a>
          </div>

          <div class="nav-section">
            <h3 class="section-header">Monitoring</h3>
            
            <a mat-list-item 
               class="nav-item" 
               routerLink="/scraper-logs" 
               routerLinkActive="active-link">
              <div class="nav-item-content">
                <mat-icon class="nav-icon">history</mat-icon>
                <span class="nav-label">Scraper Logs</span>
              </div>
              <div class="state-layer"></div>
            </a>
          </div>

          <div class="nav-section">
            <h3 class="section-header">User Management</h3>
            
            <a mat-list-item 
               class="nav-item" 
               routerLink="/users" 
               routerLinkActive="active-link">
              <div class="nav-item-content">
                <mat-icon class="nav-icon">people</mat-icon>
                <span class="nav-label">Users</span>
              </div>
              <div class="state-layer"></div>
            </a>
          </div>
        </ng-container>

        <!-- User, Admin, and Moderator accessible sections -->
        <ng-container *hasAnyRole="['User', 'Admin', 'Moderator']">
          <div class="nav-section">
            <h3 class="section-header">Content Management</h3>
            
            <a mat-list-item 
               class="nav-item" 
               routerLink="/mappings" 
               routerLinkActive="active-link">
              <div class="nav-item-content">
                <mat-icon class="nav-icon">link</mat-icon>
                <span class="nav-label">Product Mappings</span>
              </div>
              <div class="state-layer"></div>
            </a>
          </div>
        </ng-container>

        <!-- User features - accessible to Users and Admins -->
        <ng-container *hasAnyRole="['User', 'Admin']">
          <div class="nav-section">
            <h3 class="section-header">Personal</h3>
            
            <a mat-list-item 
               class="nav-item" 
               routerLink="/alerts" 
               routerLinkActive="active-link">
              <div class="nav-item-content">
                <mat-icon class="nav-icon">notifications</mat-icon>
                <span class="nav-label">Alert Rules</span>
              </div>
              <div class="state-layer"></div>
            </a>

            <a mat-list-item 
               class="nav-item" 
               routerLink="/notification-settings" 
               routerLinkActive="active-link">
              <div class="nav-item-content">
                <mat-icon class="nav-icon">settings_applications</mat-icon>
                <span class="nav-label">Notification Settings</span>
              </div>
              <div class="state-layer"></div>
            </a>
          </div>
        </ng-container>

        <!-- Development/Testing -->
        <div class="nav-section">
          <h3 class="section-header">Development</h3>
          
          <a mat-list-item 
             class="nav-item" 
             routerLink="/rbac-demo" 
             routerLinkActive="active-link">
            <div class="nav-item-content">
              <mat-icon class="nav-icon">security</mat-icon>
              <span class="nav-label">RBAC Demo</span>
            </div>
            <div class="state-layer"></div>
          </a>
        </div>
      </nav>
    </div>
  </mat-sidenav>

  <!-- Main content -->
  <mat-sidenav-content style="margin-left: 1px;">
    <!-- Top toolbar -->
    <mat-toolbar color="primary" class="main-toolbar">
      <div class="toolbar-content">
        <div class="toolbar-start">
          <span class="toolbar-title">TechTicker</span>
        </div>

        <div class="toolbar-end">
          <!-- User menu -->
          <button mat-icon-button 
                  class="user-menu-button"
                  [matMenuTriggerFor]="userMenu" 
                  *ngIf="currentUser"
                  [attr.aria-label]="'User menu for ' + currentUser?.firstName">
            <mat-icon>account_circle</mat-icon>
          </button>
          <mat-menu #userMenu="matMenu" class="user-menu">
            <div class="user-info">
              <div class="user-avatar">
                <mat-icon>account_circle</mat-icon>
              </div>
              <div class="user-details">
                <p class="user-name">{{currentUser?.firstName}} {{currentUser?.lastName}}</p>
                <p class="user-email">{{currentUser?.email}}</p>
              </div>
            </div>
            <mat-divider></mat-divider>
            <button mat-menu-item (click)="logout()" class="logout-item">
              <mat-icon>logout</mat-icon>
              <span>Logout</span>
            </button>
          </mat-menu>

          <button mat-icon-button
                  class="theme-toggle-button"
                  (click)="toggleTheme()" 
                  [attr.aria-label]="themeTooltip"
                  [matTooltip]="themeTooltip"
                  matTooltipPosition="below">
            <mat-icon>{{ themeIcon }}</mat-icon>
          </button>
        </div>
      </div>
    </mat-toolbar>

    <!-- Page content -->
    <div class="main-content">
      <router-outlet></router-outlet>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
