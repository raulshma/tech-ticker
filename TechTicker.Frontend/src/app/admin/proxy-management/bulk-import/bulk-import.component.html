<div class="bulk-import-container">
  <!-- Header -->
  <div class="header-section">
    <h1>Bulk Import Proxies</h1>
    <p class="subtitle">Import multiple proxies from text format</p>
  </div>

  <!-- Step Indicator -->
  <div class="step-indicator">
    <div class="step" [class.active]="currentStep === 0" [class.completed]="currentStep > 0">
      <div class="step-number">1</div>
      <div class="step-label">Input Data</div>
    </div>
    <div class="step-line" [class.completed]="currentStep > 0"></div>
    <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
      <div class="step-number">2</div>
      <div class="step-label">Preview & Validate</div>
    </div>
    <div class="step-line" [class.completed]="currentStep > 1"></div>
    <div class="step" [class.active]="currentStep === 2">
      <div class="step-number">3</div>
      <div class="step-label">Import Results</div>
    </div>
  </div>

  <!-- Step 1: Input Data -->
  <mat-card *ngIf="currentStep === 0" class="step-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>input</mat-icon>
        Enter Proxy Data
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="importForm" class="import-form">
        <div class="form-section">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Proxy List</mat-label>
            <textarea matInput 
                      formControlName="proxyText"
                      placeholder="Enter proxies (one per line)&#10;Examples:&#10;192.168.1.100:8080&#10;proxy.example.com:3128:username:password&#10;socks5://10.0.0.1:1080"
                      rows="10"
                      required></textarea>
            <mat-hint>Supported formats: host:port, host:port:username:password, protocol://host:port</mat-hint>
          </mat-form-field>
        </div>

        <div class="form-section">
          <h3>Import Options</h3>
          <div class="options-grid">
            <mat-checkbox formControlName="testAfterImport">
              Test proxies after import
            </mat-checkbox>
            <mat-checkbox formControlName="skipDuplicates">
              Skip duplicate proxies
            </mat-checkbox>
            <mat-checkbox formControlName="defaultIsActive">
              Enable imported proxies by default
            </mat-checkbox>
          </div>
        </div>

        <div class="form-section">
          <h3>Default Settings</h3>
          <div class="defaults-grid">
            <mat-form-field appearance="outline">
              <mat-label>Default Timeout (seconds)</mat-label>
              <input matInput type="number" formControlName="defaultTimeoutSeconds" min="1" max="300">
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Default Max Retries</mat-label>
              <input matInput type="number" formControlName="defaultMaxRetries" min="0" max="10">
            </mat-form-field>
          </div>
        </div>
      </form>
    </mat-card-content>

    <mat-card-actions>
      <div class="action-buttons">
        <button mat-button (click)="onCancel()" [disabled]="parsing">
          <mat-icon>cancel</mat-icon>
          Cancel
        </button>
        <button mat-raised-button color="primary" (click)="parseProxies()" [disabled]="parsing || importForm.invalid">
          <mat-spinner diameter="20" *ngIf="parsing"></mat-spinner>
          <mat-icon *ngIf="!parsing">preview</mat-icon>
          {{ parsing ? 'Parsing...' : 'Parse & Preview' }}
        </button>
      </div>
    </mat-card-actions>
  </mat-card>

  <!-- Step 2: Preview & Validate -->
  <mat-card *ngIf="currentStep === 1" class="step-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>preview</mat-icon>
        Preview Parsed Proxies
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <!-- Summary Stats -->
      <div class="summary-stats">
        <div class="stat-card valid">
          <div class="stat-number">{{ getValidProxiesCount() }}</div>
          <div class="stat-label">Valid</div>
        </div>
        <div class="stat-card duplicate">
          <div class="stat-number">{{ getDuplicateProxiesCount() }}</div>
          <div class="stat-label">Duplicates</div>
        </div>
        <div class="stat-card invalid">
          <div class="stat-number">{{ getInvalidProxiesCount() }}</div>
          <div class="stat-label">Invalid</div>
        </div>
        <div class="stat-card total">
          <div class="stat-number">{{ parsedProxies.length }}</div>
          <div class="stat-label">Total</div>
        </div>
      </div>

      <!-- Proxy Table -->
      <div class="table-container">
        <mat-table [dataSource]="parsedProxies" class="proxy-preview-table">
          <ng-container matColumnDef="host">
            <mat-header-cell *matHeaderCellDef>Host</mat-header-cell>
            <mat-cell *matCellDef="let proxy">{{ proxy.host }}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="port">
            <mat-header-cell *matHeaderCellDef>Port</mat-header-cell>
            <mat-cell *matCellDef="let proxy">{{ proxy.port }}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="type">
            <mat-header-cell *matHeaderCellDef>Type</mat-header-cell>
            <mat-cell *matCellDef="let proxy">
              <mat-chip [color]="proxy.proxyType === 'HTTP' ? 'primary' : 'accent'" selected>
                {{ proxy.proxyType }}
              </mat-chip>
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="auth">
            <mat-header-cell *matHeaderCellDef>Auth</mat-header-cell>
            <mat-cell *matCellDef="let proxy">
              <mat-icon *ngIf="hasAuthentication(proxy)" color="primary">lock</mat-icon>
              <mat-icon *ngIf="!hasAuthentication(proxy)" color="disabled">lock_open</mat-icon>
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="status">
            <mat-header-cell *matHeaderCellDef>Status</mat-header-cell>
            <mat-cell *matCellDef="let proxy">
              <mat-chip [color]="getStatusColor(proxy)" selected>
                {{ getProxyStatus(proxy) }}
              </mat-chip>
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="errors">
            <mat-header-cell *matHeaderCellDef>Issues</mat-header-cell>
            <mat-cell *matCellDef="let proxy">
              <div *ngIf="proxy.validationErrors && proxy.validationErrors.length > 0" class="error-list">
                <mat-chip *ngFor="let error of proxy.validationErrors" color="warn" selected>
                  {{ error }}
                </mat-chip>
              </div>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
        </mat-table>
      </div>
    </mat-card-content>

    <mat-card-actions>
      <div class="action-buttons">
        <button mat-button (click)="goBack()" [disabled]="validating || importing">
          <mat-icon>arrow_back</mat-icon>
          Back
        </button>
        <button mat-button color="accent" (click)="validateImport()" [disabled]="validating || importing">
          <mat-spinner diameter="20" *ngIf="validating"></mat-spinner>
          <mat-icon *ngIf="!validating">check_circle</mat-icon>
          {{ validating ? 'Validating...' : 'Validate' }}
        </button>
        <button mat-raised-button color="primary" (click)="performImport()" 
                [disabled]="importing || getValidProxiesCount() === 0">
          <mat-spinner diameter="20" *ngIf="importing"></mat-spinner>
          <mat-icon *ngIf="!importing">upload</mat-icon>
          {{ importing ? 'Importing...' : 'Import Proxies' }}
        </button>
      </div>
    </mat-card-actions>
  </mat-card>

  <!-- Step 3: Import Results -->
  <mat-card *ngIf="currentStep === 2" class="step-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>check_circle</mat-icon>
        Import Results
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <div class="results-summary" *ngIf="importResult">
        <div class="result-message">
          <mat-icon class="success-icon">check_circle</mat-icon>
          <h3>Import Completed Successfully!</h3>
          <p>{{ importResult.totalProcessed }} proxies processed</p>
        </div>

        <div class="results-stats">
          <div class="result-stat success">
            <div class="stat-number">{{ importResult.successfulImports }}</div>
            <div class="stat-label">Imported</div>
          </div>
          <div class="result-stat skipped">
            <div class="stat-number">{{ importResult.skippedDuplicates }}</div>
            <div class="stat-label">Skipped</div>
          </div>
          <div class="result-stat failed">
            <div class="stat-number">{{ importResult.failedImports }}</div>
            <div class="stat-label">Failed</div>
          </div>
        </div>

        <div class="error-details" *ngIf="importResult.errors && importResult.errors.length > 0">
          <h4>Import Errors:</h4>
          <div class="error-list">
            <mat-chip *ngFor="let error of importResult.errors" color="warn" selected>
              {{ error }}
            </mat-chip>
          </div>
        </div>
      </div>
    </mat-card-content>

    <mat-card-actions>
      <div class="action-buttons">
        <button mat-button (click)="startOver()">
          <mat-icon>refresh</mat-icon>
          Import More
        </button>
        <button mat-raised-button color="primary" (click)="onCancel()">
          <mat-icon>list</mat-icon>
          View Proxy List
        </button>
      </div>
    </mat-card-actions>
  </mat-card>
</div>
